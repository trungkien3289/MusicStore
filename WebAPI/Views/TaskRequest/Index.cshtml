
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_DashBoard_Layout.cshtml";
}

@section scripts{
    <script src="~/Scripts/build/taskRequest.js"></script>
}
@section css{
    <link href="~/Content/TaskRequest/scss/main.css" rel="stylesheet" />
}
<div class="app-main__outer">
    <div class="app-main__inner">
        <div class="task-request-management-wrapper">
            <div class="col-md-3 col-xl-3 card left-panel">
                <div class="card-header card-header-tab-animation">
                    Projects
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        <div class=" project-task-panel" data-bind="foreach: projects">
                            <div class="d-flex flex-row align-items-center" height="30px">
                                <a class="btn-toogle-panel collapsed" data-toggle="collapse" data-bind="attr : {href : ProjectButtonHRef}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                    <i class="metismenu-state-icon pe-7s-angle-down caret-left"></i>
                                    <i class="metismenu-state-icon pe-7s-angle-up caret-left"></i>
                                </a>
                                <a class="btn-project-item tree-node-btn" data-bind="attr:{'data-id' : Id}">
                                    <i class="metismenu-icon fa fa-suitcase"></i>
                                    <span data-bind="text: Name"></span>
                                </a>
                            </div>
                            <div class="collapse" data-bind="attr: {id: ProjectExpandPanelId}">
                                <ul class="vertical-nav-menu project-tree" data-bind="foreach: Tasks">
                                    <li>
                                        <a data-bind="attr:{'data-id': Id}" class="btn-task-item tree-node-btn">
                                            <i class="fa fa-tasks"></i>
                                            <span data-bind="text: Name"></span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-9 col-xl-9 right-panel main-card card">
                <div data-bind="if: isShowTaskRequest" class="task-request-details-container">
                    <div class="card-header">
                        <span class="title">Task Request Details</span>
                        <button class="waves-effect waves-light btn-small btn-add-task-request blue"
                                data-bind="hidden: hasTaskRequest ,click:$root.addTaskRequestBtnClick, clickBubble: false">
                            <i class="material-icons">add</i>Add Request
                        </button>
                        <button class="waves-effect waves-light btn-small btn-edit-task-request blue"
                                data-bind="visible: hasTaskRequest ,click:$root.editTaskRequestBtnClick, clickBubble: false">
                            <i class="material-icons">edit</i>Edit
                        </button>
                        <button class="waves-effect waves-light btn-small btn-delete-task-request red"
                                data-bind="visible: hasTaskRequest ,click:$root.deleteTaskRequestBtnClick, clickBubble: false">
                            <i class="material-icons">delete</i>Delete
                        </button>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="task-details-panel" data-bind="template: {name:'taskDetailsTemplate', data: currentTask}"></div>
                        <div class="task-request-details-wrapper" data-bind="visible: hasTaskRequest">
                            <div class="task-request-details-panel" data-bind="template: {name:'taskRequestDetailsTemplate', data: currentTaskRequest}"></div>
                        </div>
                    </div>
                </div>

                <div id="ProjectPanel" data-bind="visible: isShowProjectDetail" class="sub-dashboard-content">
                    <div class="card-header">Project Details</div>
                    <div class="card-body d-flex flex-column">
                        <div data-bind="template: {name:'projectDetailsTemplate', data: currentProject}" class="d-flex flex-column flex-auto-fill"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Task Request Dialog -->
<div id="addTaskRequestDialog" class="modal modal-fixed-footer">
    <div class="modal-header" data-bind="with: addEditTaskRequestModel">
        <span data-bind="visible:IsEdit">Edit Task Request</span>
        <span data-bind="hidden:IsEdit">Add Task Request</span>
    </div>
    <div class="modal-content" data-bind="template: {name: 'addTaskRequestDialogTemplate', data: addEditTaskRequestModel}">
        
    </div>
    <div class="modal-footer" data-bind="with: addEditTaskRequestModel">
        <a id="btnOK" class="waves-effect waves-orange btn-flat btn" data-bind="click: $root.okBtnDialogClick">OK</a>
        <a id="btnCancel" class="modal-close waves-effect btn-flat">Cancel</a>
    </div>
</div>

<script type="text/x-jquery-tmpl" id="addTaskRequestDialogTemplate">
        <div class="form-group">
            <div class="input-field col s12">
                <textarea id="description_addTaskRequest" class="materialize-textarea" data-bind="value: Description"></textarea>
                <label class="active" for="description_addTaskRequest">Description</label>
            </div>
        </div>
        <div class="form-group">
            <div class="input-field col s12 select-control">
                <select data-bind="value: Status">
                    <option value="0">New</option>
                    <option value="1">Active</option>
                    <option value="2">Close</option>
                </select>
                <label>Status</label>
            </div>
        </div>
        <div class="form-group">
            <div class="input-field col s12 select-control">
                <select data-bind="options: $root.availableDevelopers, selectedOptions: Developers, optionsText: 'UserName', optionsValue: 'UserId'" size="5" multiple="true"></select>
                <label>Developers</label>
            </div>
        </div>
</script>

<script type="text/x-jquery-tmpl" id="taskDetailsTemplate">
    <div class="row-data align-items-center project-title-panel">
        <span class="icon-space-wrapper">
            <i class="nav-link-icon fa fa-suitcase"> </i>
        </span>
        <div class="project-title" data-bind="text: Name"></div>
    </div>
    <div class="row-data bd-highligh">
        <p class=""><i data-bind="text: Description"></i></p>
    </div>
    <div class="row-data project-time-panel">
        <div class="d-flex flex-column time-group-controls">
            <div class="d-flex flex-row align-items-center">
                <span class="icon-space-wrapper">
                    <i class="fa fa-calendar-alt"></i>
                </span>
                <span class="time-group-subject">Start Date</span>
            </div>
            <span data-bind="text: StartDate"></span>
        </div>
        <div class="d-flex flex-column time-group-controls">
            <div class="d-flex flex-row align-items-center">
                <span class="icon-space-wrapper"><i class="fa fa-calendar-alt"></i></span>
                <span class="time-group-subject">End Date</span>
            </div>
            <span data-bind="text: EndDate"></span>
        </div>
        <div class="d-flex flex-column align-items-center time-group-controls">
            <div class="d-flex flex-row align-items-center">
                <span class="icon-space-wrapper"><i class="fa fa-calendar-alt"></i></span>
                <span class="time-group-subject">Estimate Time(hours)</span>
            </div>
            <span data-bind="text: EstimatedTime"></span>
        </div>
    </div>
    <div class="form-group row" data-bind="if: Assignee != null">
        <label class="font-weight-bold col-sm-2 col-form-label">Task Request Assignee</label>
        <div class="col-sm-10 d-flex flex-row align-items-center" data-bind="with: Assignee">
            <div class="project-member-wrapper">
                <span><i class="fas fa-user-tie"></i></span>
                <div data-bind="text: Name"></div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-jquery-tmpl" id="taskRequestDetailsTemplate">
    <div class="form-group row">
        <label class="font-weight-bold col-sm-2 col-form-label">Request Status</label>
        <div class="col-sm-10 d-flex flex-row align-items-center">
            <div data-bind="if: Status == 0">
                <span class="new badge blue float-left" data-badge-caption="">New</span>
            </div>
            <div data-bind="if: Status == 1">
                <span class="new badge blue float-left" data-badge-caption="">Active</span>
            </div>
            <div data-bind="if: Status == 2">
                <span class="new badge blue float-left" data-badge-caption="">Close</span>
            </div>
        </div>
    </div>
    <div class="form-group row">
        <label class="font-weight-bold col-sm-2 col-form-label">Request Description</label>
        <p class="col-sm-12"><i data-bind="text: Description"></i></p>
    </div>
    <div class="form-group row task-request-developers-container">
        <label for="listTaskRequestDeveloper" class="font-weight-bold col-sm-12 col-form-label">Task Request Developer Target</label>
        <div id="listTaskRequestDeveloper" class="col-sm-12">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Status</th>
                        <th width="120px;"></th>
                    </tr>
                </thead>

                <tbody data-bind="foreach: Developers, as : 'developer'">
                    <tr>
                        <td data-bind="text: UserName"></td>
                        <td>
                            <div data-bind="if: IsJoin">
                                <span class="new badge blue" data-badge-caption="">Joined</span>
                            </div>
                            <div data-bind="ifnot : IsJoin">
                                <span class="new badge blue" data-badge-caption="">Pending</span>
                            </div>
                        </td>
                        <td>
                            <div data-bind="ifnot:$root.isTaskAssignee">
                            <button data-bind="visible:IsJoin, click: function(data, event) { $root.pickUpDeveloperBtnClick(TaskRequestId, UserId) }" 
                                    class="waves-effect waves-light btn blue">
                                <i class="material-icons right">send</i>Pick
                                </button>
                            </div>
                            <div data-bind="if:IsAssigned">
                            <button data-bind="click: function(data, event) { $root.unassignDeveloperBtnClick(TaskRequestId, UserId) }" 
                                    class="waves-effect waves-light btn red btn-unassign-developer">
                                <i class="material-icons right">send</i>Unassign
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</script>

<script type="text/x-jquery-tmpl" id="projectDetailsTemplate">
       
            <div class="row-data align-items-center project-title-panel">
                <span class="icon-space-wrapper">
                    <i class="nav-link-icon fa fa-suitcase"> </i>
                </span>
                <div class="project-title" data-bind="text: Name"></div>
            </div>
            <div class="row-data bd-highligh">
                <i><p data-bind="text: Description"></p></i>
            </div>
            <div class="row-data project-time-panel">
                <div class="d-flex flex-column time-group-controls">
                    <div class="d-flex flex-row align-items-center">
                        <span class="icon-space-wrapper">
                            <i class="fa fa-calendar-alt"></i>
                        </span>
                        <span class="time-group-subject">Start Date</span>
                    </div>
                    <span data-bind="text: StartDate"></span>
                </div>
                <div class="d-flex flex-column time-group-controls">
                    <div class="d-flex flex-row align-items-center">
                        <span class="icon-space-wrapper"><i class="fa fa-calendar-alt"></i></span>
                        <span class="time-group-subject">End Date</span>
                    </div>
                    <span data-bind="text: EndDate"></span>
                </div>
            </div>
            <div class="row-data user-group-controls">
                <label>Leaders</label>
                <div data-bind="foreach: Leaders" class="d-flex flex-row align-items-center">
                    <div class="project-member-wrapper">
                        <span><i class="fas fa-user-tie"></i></span>
                        <div data-bind="text: Name"></div>
                    </div>
                </div>
            </div>
            <div class="row-data user-group-controls">
                <label>Developers</label>
                <div data-bind="foreach: Developers" class="d-flex flex-row align-items-center">
                    <div class="project-member-wrapper">
                        <span><i class="fas fa-user"></i></span>
                        <div data-bind="text: Name"></div>
                    </div>
                </div>
            </div>
</script>